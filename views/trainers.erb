<div class="pokemon-filter">	
	<div class="filter-title">Search</div>
	<input class="filter-input" id="search-text"/>
	<button class="btn -default" id="search-text-btn" type="button">Search</button>			
</div>

<div class="pokemon-list spreadsheet" id="trainers">
	<div class="expanded-field field-header">
		<div class="expanded-field-main">
			<div class="trainer-id">ID</div>
			<div class="trainer-name">Name</div>
			<div class="trainer-class">Class</div>
			<div class="trainer-btype">Battle Type</div>
			<div class="trainer-moves">Moves</div>
			<div class="trainer-items">Items</div>
			<div class="trainer-poks" >Pokemon</div>
		</div>
	</div>

	<% @trainers.each_with_index do |trainer, i| %>
		<div class="expanded-field filterable" data-index="<%= i %>">
			<div class="expanded-field-main">
				<div class="trainer-id"><%= i %></div>

				<div class="trainer-name"><%= @names[i] %></div>

				<div class="trainer-class">
					<%= trainer["class_id"] %>: <%= @class_names[trainer["class_id"]] %>		
				</div>

				<%= field "battle_type_1", 'trainer-btype', {value: trainer["battle_type_1"],  narc: "trdata", autofill: "battle_types"} %>	

				<div class="trainer-moves">
					<label class="container">
					  <input type="checkbox" <%= Trdata.has_moves?(trainer) %>>
					  <span class="checkmark"></span>
					</label>
				</div>
				<div class="trainer-items">
					<label class="container">
					  <input type="checkbox" <%= Trdata.has_items?(trainer) %>>
					  <span class="checkmark"></span>
					</label>
				</div>

				<div class="trainer-poks" >
					<% Trpok.get_poks_for(trainer["num_pokemon"], @trainer_poks[i]).each_with_index do |pok, i| %>
						<div class="wild">
							<%= img "pokesprite/#{pok}.png", "", ["show", "pok-#{i}"] %>
						</div>
					<% end %>	
				</div>
				<%= svg "svgs/misc_data", 'move-info expand-action expand-trainer svg no-fill', ["expand", "trainer"] %>
			</div>
			
			<div class="expanded-card-content expanded-trainer">
				<div class="expanded-left">
					<% (1..4).each do |n| %>
						<div class="expanded-field">
							<div class="expanded-trlabel">Item <%= n %></div>
							<%= field "item_#{n}", 'tr-item', {value: trainer["item_#{n}"],  narc: "trdata", autofill: "items"} %>	
						</div>
					<% end %>			
				</div>
				<div class="expanded-left">
					<div class="expanded-field">
						<div class="expanded-trlabel">AI Value</div>
						<%= field "ai", 'tr-item', {value: trainer["ai"],  narc: "trdata", type: "int-255"} %>	
					</div>
					<div class="expanded-field">
						<div class="expanded-trlabel">Reward $</div>
						<%= field "money", 'tr-item', {value: trainer["money"],  narc: "trdata", type: "int-255"} %>	
					</div>
					<div class="expanded-field">
						<div class="expanded-trlabel">Reward Item</div>
						<%= field "reward_item", 'tr-item', {value: trainer["reward_item"],  narc: "trdata", autofill: "items"} %>
					</div>
					<div class="expanded-field">
						<div class="expanded-trlabel">Heal?</div>
						<%= field "heal", 'tr-item', {value: trainer["heal"],  narc: "trdata", type: "int-1"} %>	
					</div>
				</div>
			</div>

			<% poks = @trainer_poks[i] %>
			<% (0..trainer["num_pokemon"]-1).each do |pok_index| %>
				<div class="expanded-card-subcontent expanded-pok expanded-pok-<%= pok_index %>">
					<div class="expanded-left">
						<div class="expanded-field">
							<div class="expanded-trlabel">Species</div>
							<%= field "species_id_#{pok_index}", 'tr-item', {value: poks["species_id_#{pok_index}"],  narc: "trpok", autofill: "pokemon_names"} %>	
						</div>
						<div class="expanded-field">
							<div class="expanded-trlabel">Level</div>
							<%= field "level_#{pok_index}", 'tr-item', {value: poks["level_#{pok_index}"],  narc: "trpok", type: "int-100"} %>	
						</div>
						<div class="expanded-field">
							<div class="expanded-trlabel">Ability Slot</div>
							<%= field "ability_#{pok_index}", 'tr-item', {value: poks["ability_#{pok_index}"],  narc: "trpok", type: "int-2"} %>	
						</div>
						<div class="expanded-field">
							<div class="expanded-trlabel">Gender</div>
							<%= field "ability_#{pok_index}", 'tr-item', {value: poks["gender_#{pok_index}"],  narc: "trpok", autofill: "genders"} %>	
						</div>
						<div class="expanded-field">
							<div class="expanded-trlabel">IVs</div>
							<%= field "ivs_#{pok_index}", 'tr-item', {value: poks["ivs_#{pok_index}"],  narc: "trpok", type: "int-255"} %>	
						</div>
						<div class="expanded-field">
							<div class="expanded-trlabel">Form</div>
							<%= field "form_#{pok_index}", 'tr-item', {value: poks["form_#{pok_index}"],  narc: "trpok", type: "int-255"} %>	
						</div>
					</div>


					<div class="expanded-left">
						<div class="expanded-field">
							<div class="expanded-trlabel">Held Item</div>
							<%= field "item_id_#{pok_index}", 'tr-item', {value: poks["item_id_#{pok_index}"],  narc: "trpok", autofill: "items"} %>	
						</div>
						<% (1..4).each do |m| %>
							<div class="expanded-field">
								<div class="expanded-trlabel">Move <%= m %></div>
								<%= field "move_#{m}_#{pok_index}", 'tr-item', {value: poks["move_#{m}_#{pok_index}"] || "-",  narc: "trpok", autofill: "move_names"} %>	
							</div>
						<% end %>	
					</div>
				</div>
			<% end %>	
		</div>

		
	<% end %>
	
</div>


<script>
	// json object for filtering
	trainers = <%= @trainers.to_json %>


	// info for autocomplete
	autofills = {
		<% [:items, :pokemon_names, :abilities].each do |info| %>
			"<%= info.to_s %>": <%= RomInfo.send(info) %>,
		<% end %>
		"move_names": <%= @move_names %>
	}


</script>
